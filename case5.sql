{{ config(tags=['unit-test']) }}

{% call dbt_unit_testing.test('adjusted_combined', 'full refresh test') %}

  {% call dbt_unit_testing.mock_ref ('adjusted_final') %}
      tvldt    | pos  | poo   | org   | dst   | downal | dmktal | dopral | mktal1 | mktal2 | mktal3 | opral1 | opral2 | opral3 | cnx1  | cnx2  | stp1        | stp2        | stp3        | bkclass_a | bkclass_b | bkclass_c | bkclass_d | bkclass_e | bkclass_f | bkclass_g | bkclass_h | bkclass_i | bkclass_j | bkclass_k | bkclass_l | bkclass_m | bkclass_n | bkclass_o | bkclass_p | bkclass_q | bkclass_r | bkclass_s | bkclass_t | bkclass_u | bkclass_v | bkclass_w | bkclass_x | bkclass_y | bkclass_z | bkgunkwncls | total | cnx1a    | cnx2a    | file_date    | file_type        | load_timestamp
      '202001' | 'TR' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | 'ZZZ'    | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
  {% endcall %}

  {% call dbt_unit_testing.mock_ref ('adjusted_preliminary') %}
      tvldt    | pos  | poo   | org   | dst   | downal | dmktal | dopral | mktal1 | mktal2 | mktal3 | opral1 | opral2 | opral3 | cnx1  | cnx2  | stp1        | stp2        | stp3        | bkclass_a | bkclass_b | bkclass_c | bkclass_d | bkclass_e | bkclass_f | bkclass_g | bkclass_h | bkclass_i | bkclass_j | bkclass_k | bkclass_l | bkclass_m | bkclass_n | bkclass_o | bkclass_p | bkclass_q | bkclass_r | bkclass_s | bkclass_t | bkclass_u | bkclass_v | bkclass_w | bkclass_x | bkclass_y | bkclass_z | bkgunkwncls | total | cnx1a    | cnx2a    | file_date    | file_type         | load_timestamp
      '202002' | 'TR' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | 'ZZZ'    | '2020-01-01' | 'ADJUSTED PRELIM' | '2017-01-01 12:00:00'
  {% endcall %}

  {% call dbt_unit_testing.mock_ref ('adjusted_combined') %}
      traffic_id                                                                                                                | travel_month | point_of_sale_country | point_of_origin_airport | scheduled_departure_airport_iata | scheduled_arrival_airport_iata | dominant_owner_carrier | dominant_marketing_carrier | dominant_operating_carrier | marketing_carrier_leg_1 | marketing_carrier_leg_2 | marketing_carrier_leg_3 | operating_carrier_leg_1 | operating_carrier_leg_2 | operating_carrier_leg_3 | connecting_airport_1 | connecting_airport_2 | connecting_airport_1_a | connecting_airport_2_a | stopping_airport_1_leg_1 | stopping_airport_2_leg_1 | stopping_airport_3_leg_1 | stopping_airport_1_leg_2 | stopping_airport_2_leg_2 | stopping_airport_3_leg_2 | stopping_airport_1_leg_3 | stopping_airport_2_leg_3 | stopping_airport_3_leg_3 | legs_total | passengers_booking_class_a | passengers_booking_class_b | passengers_booking_class_c | passengers_booking_class_d | passengers_booking_class_e | passengers_booking_class_f | passengers_booking_class_g | passengers_booking_class_h | passengers_booking_class_i | passengers_booking_class_j | passengers_booking_class_k | passengers_booking_class_l | passengers_booking_class_m | passengers_booking_class_n | passengers_booking_class_o | passengers_booking_class_p | passengers_booking_class_q | passengers_booking_class_r | passengers_booking_class_s | passengers_booking_class_t | passengers_booking_class_u | passengers_booking_class_v | passengers_booking_class_w | passengers_booking_class_x | passengers_booking_class_y | passengers_booking_class_z | passengers_booking_class_unknown | passengers_total | file_date    | file_type         | LOAD_TIMESTAMP
      'ADJUSTED FINAL/2020-01-01/TR/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ' | '2020-01-01' | 'TR'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | 3          | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED FINAL'  | '2017-01-01 12:00:00'
      'ADJUSTED PRELIM/2020-02-01/TR/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ'| '2020-02-01' | 'TR'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | 3          | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED PRELIM' | '2017-01-01 12:00:00'
  {% endcall %}

  {% call dbt_unit_testing.expect() %}
      traffic_id                                                                                                                | travel_month | point_of_sale_country | point_of_origin_airport | scheduled_departure_airport_iata | scheduled_arrival_airport_iata | dominant_owner_carrier | dominant_marketing_carrier | dominant_operating_carrier | marketing_carrier_leg_1 | marketing_carrier_leg_2 | marketing_carrier_leg_3 | operating_carrier_leg_1 | operating_carrier_leg_2 | operating_carrier_leg_3 | connecting_airport_1 | connecting_airport_2 | connecting_airport_1_a | connecting_airport_2_a | stopping_airport_1_leg_1 | stopping_airport_2_leg_1 | stopping_airport_3_leg_1 | stopping_airport_1_leg_2 | stopping_airport_2_leg_2 | stopping_airport_3_leg_2 | stopping_airport_1_leg_3 | stopping_airport_2_leg_3 | stopping_airport_3_leg_3 | legs_total | passengers_booking_class_a | passengers_booking_class_b | passengers_booking_class_c | passengers_booking_class_d | passengers_booking_class_e | passengers_booking_class_f | passengers_booking_class_g | passengers_booking_class_h | passengers_booking_class_i | passengers_booking_class_j | passengers_booking_class_k | passengers_booking_class_l | passengers_booking_class_m | passengers_booking_class_n | passengers_booking_class_o | passengers_booking_class_p | passengers_booking_class_q | passengers_booking_class_r | passengers_booking_class_s | passengers_booking_class_t | passengers_booking_class_u | passengers_booking_class_v | passengers_booking_class_w | passengers_booking_class_x | passengers_booking_class_y | passengers_booking_class_z | passengers_booking_class_unknown | passengers_total | file_date    | file_type         | LOAD_TIMESTAMP
      'ADJUSTED FINAL/2020-01-01/TR/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ' | '2020-01-01' | 'TR'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | 3          | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED FINAL'  | '2017-01-01 12:00:00'
      'ADJUSTED PRELIM/2020-02-01/TR/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ'| '2020-02-01' | 'TR'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | 3          | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED PRELIM' | '2017-01-01 12:00:00'
  {% endcall %}
{% endcall %}

UNION ALL

{% call dbt_unit_testing.test('adjusted_combined', 'record added when load_date > max(load_date), different and the same traffic_id. Incremental test', options={"run_as_incremental": "True"}) %}

  {% call dbt_unit_testing.mock_ref ('adjusted_final') %}
      tvldt    | pos  | poo   | org   | dst   | downal | dmktal | dopral | mktal1 | mktal2 | mktal3 | opral1 | opral2 | opral3 | cnx1  | cnx2  | stp1        | stp2        | stp3        | bkclass_a | bkclass_b | bkclass_c | bkclass_d | bkclass_e | bkclass_f | bkclass_g | bkclass_h | bkclass_i | bkclass_j | bkclass_k | bkclass_l | bkclass_m | bkclass_n | bkclass_o | bkclass_p | bkclass_q | bkclass_r | bkclass_s | bkclass_t | bkclass_u | bkclass_v | bkclass_w | bkclass_x | bkclass_y | bkclass_z | bkgunkwncls | total | cnx1a    | cnx2a    | file_date    | file_type        | load_timestamp
      '202001' | 'TR' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | 'ZZZ'    | '2020-01-01' | 'ADJUSTED FINAL' | '2022-01-01 12:00:00'
      '202002' | 'XX' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | 'ZZZ'    | '2020-02-01' | 'ADJUSTED FINAL' | '2022-01-02 12:00:00'
      '202003' | 'AA' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | 'ZZZ'    | '2020-03-01' | 'ADJUSTED FINAL' | '2022-01-03 12:00:00'
      '202001' | 'ZZ' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 10        | 20        | 30        | 40        | 50        | 60        | 70        | 80        | 90        | 100       | 110       | 120       | 130       | 140       | 150       | 160       | 170       | 180       | 190       | 200       | 210       | 220       | 230       | 240       | 250       | 260       | 270         | 280   | 'YYY'    | 'ZZZ'    | '2020-03-01' | 'ADJUSTED FINAL' | '2022-01-03 12:00:00'
  {% endcall %}

  {% call dbt_unit_testing.mock_ref ('adjusted_preliminary') %}
      tvldt    | pos  | poo   | org   | dst   | downal | dmktal | dopral | mktal1 | mktal2 | mktal3 | opral1 | opral2 | opral3 | cnx1  | cnx2  | stp1        | stp2        | stp3        | bkclass_a | bkclass_b | bkclass_c | bkclass_d | bkclass_e | bkclass_f | bkclass_g | bkclass_h | bkclass_i | bkclass_j | bkclass_k | bkclass_l | bkclass_m | bkclass_n | bkclass_o | bkclass_p | bkclass_q | bkclass_r | bkclass_s | bkclass_t | bkclass_u | bkclass_v | bkclass_w | bkclass_x | bkclass_y | bkclass_z | bkgunkwncls | total | cnx1a    | cnx2a    | file_date    | file_type         | load_timestamp
      '202001' | 'TR' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | 'ZZZ'    | '2020-01-01' | 'ADJUSTED PRELIM' | '2022-01-01 12:00:00'
      '202002' | 'XX' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | 'ZZZ'    | '2020-02-01' | 'ADJUSTED PRELIM' | '2022-01-02 12:00:00'
      '202003' | 'XY' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | 'ZZZ'    | '2020-03-01' | 'ADJUSTED PRELIM' | '2022-01-03 12:00:00'
      '202002' | 'GG' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 10        | 20        | 30        | 40        | 50        | 60        | 70        | 80        | 90        | 100       | 110       | 120       | 130       | 140       | 150       | 160       | 170       | 180       | 190       | 200       | 210       | 220       | 230       | 240       | 250       | 260       | 270         | 280   | 'YYY'    | 'ZZZ'    | '2020-03-01' | 'ADJUSTED PRELIM' | '2022-01-03 12:00:00'
  {% endcall %}

  {% call dbt_unit_testing.mock_ref ('adjusted_combined') %}
      traffic_id                                                                                                                | travel_month | point_of_sale_country | point_of_origin_airport | scheduled_departure_airport_iata | scheduled_arrival_airport_iata | dominant_owner_carrier | dominant_marketing_carrier | dominant_operating_carrier | marketing_carrier_leg_1 | marketing_carrier_leg_2 | marketing_carrier_leg_3 | operating_carrier_leg_1 | operating_carrier_leg_2 | operating_carrier_leg_3 | connecting_airport_1 | connecting_airport_2 | connecting_airport_1_a | connecting_airport_2_a | stopping_airport_1_leg_1 | stopping_airport_2_leg_1 | stopping_airport_3_leg_1 | stopping_airport_1_leg_2 | stopping_airport_2_leg_2 | stopping_airport_3_leg_2 | stopping_airport_1_leg_3 | stopping_airport_2_leg_3 | stopping_airport_3_leg_3 | passengers_booking_class_a | passengers_booking_class_b | passengers_booking_class_c | passengers_booking_class_d | passengers_booking_class_e | passengers_booking_class_f | passengers_booking_class_g | passengers_booking_class_h | passengers_booking_class_i | passengers_booking_class_j | passengers_booking_class_k | passengers_booking_class_l | passengers_booking_class_m | passengers_booking_class_n | passengers_booking_class_o | passengers_booking_class_p | passengers_booking_class_q | passengers_booking_class_r | passengers_booking_class_s | passengers_booking_class_t | passengers_booking_class_u | passengers_booking_class_v | passengers_booking_class_w | passengers_booking_class_x | passengers_booking_class_y | passengers_booking_class_z | passengers_booking_class_unknown | passengers_total | file_date    | file_type         | LOAD_TIMESTAMP
      'ADJUSTED FINAL/2020-01-01/ZZ/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ' | '2020-01-01' | 'ZZ'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED FINAL'  | '2022-01-01 12:00:00'
      'ADJUSTED PRELIM/2020-02-01/GG/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ'| '2020-02-01' | 'GG'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-02-01' | 'ADJUSTED PRELIM' | '2022-01-01 12:00:00'

  {% endcall %}

  {% call dbt_unit_testing.expect() %}
      traffic_id                                                                                                                | travel_month | point_of_sale_country | point_of_origin_airport | scheduled_departure_airport_iata | scheduled_arrival_airport_iata | dominant_owner_carrier | dominant_marketing_carrier | dominant_operating_carrier | marketing_carrier_leg_1 | marketing_carrier_leg_2 | marketing_carrier_leg_3 | operating_carrier_leg_1 | operating_carrier_leg_2 | operating_carrier_leg_3 | connecting_airport_1 | connecting_airport_2 | connecting_airport_1_a | connecting_airport_2_a | stopping_airport_1_leg_1 | stopping_airport_2_leg_1 | stopping_airport_3_leg_1 | stopping_airport_1_leg_2 | stopping_airport_2_leg_2 | stopping_airport_3_leg_2 | stopping_airport_1_leg_3 | stopping_airport_2_leg_3 | stopping_airport_3_leg_3 | passengers_booking_class_a | passengers_booking_class_b | passengers_booking_class_c | passengers_booking_class_d | passengers_booking_class_e | passengers_booking_class_f | passengers_booking_class_g | passengers_booking_class_h | passengers_booking_class_i | passengers_booking_class_j | passengers_booking_class_k | passengers_booking_class_l | passengers_booking_class_m | passengers_booking_class_n | passengers_booking_class_o | passengers_booking_class_p | passengers_booking_class_q | passengers_booking_class_r | passengers_booking_class_s | passengers_booking_class_t | passengers_booking_class_u | passengers_booking_class_v | passengers_booking_class_w | passengers_booking_class_x | passengers_booking_class_y | passengers_booking_class_z | passengers_booking_class_unknown | passengers_total | file_date    | file_type         | LOAD_TIMESTAMP
      'ADJUSTED FINAL/2020-02-01/XX/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ' | '2020-02-01' | 'XX'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-02-01' | 'ADJUSTED FINAL'  | '2022-01-02 12:00:00'
      'ADJUSTED FINAL/2020-03-01/AA/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ' | '2020-03-01' | 'AA'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-03-01' | 'ADJUSTED FINAL'  | '2022-01-03 12:00:00'
      'ADJUSTED FINAL/2020-01-01/ZZ/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ' | '2020-01-01' | 'ZZ'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | 10                         | 20                         | 30                         | 40                         | 50                         | 60                         | 70                         | 80                         | 90                         | 100                        | 110                        | 120                        | 130                        | 140                        | 150                        | 160                        | 170                        | 180                        | 190                        | 200                        | 210                        | 220                        | 230                        | 240                        | 250                        | 260                        | 270                              | 280              | '2020-03-01' | 'ADJUSTED FINAL'  | '2022-01-03 12:00:00'
      'ADJUSTED PRELIM/2020-02-01/XX/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ'| '2020-02-01' | 'XX'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-02-01' | 'ADJUSTED PRELIM' | '2022-01-02 12:00:00'
      'ADJUSTED PRELIM/2020-03-01/XY/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ'| '2020-03-01' | 'XY'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-03-01' | 'ADJUSTED PRELIM' | '2022-01-03 12:00:00'
      'ADJUSTED PRELIM/2020-02-01/GG/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ'| '2020-02-01' | 'GG'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | 10                         | 20                         | 30                         | 40                         | 50                         | 60                         | 70                         | 80                         | 90                         | 100                        | 110                        | 120                        | 130                        | 140                        | 150                        | 160                        | 170                        | 180                        | 190                        | 200                        | 210                        | 220                        | 230                        | 240                        | 250                        | 260                        | 270                              | 280              | '2020-03-01' | 'ADJUSTED PRELIM' | '2022-01-03 12:00:00'
  {% endcall %}

{% endcall %}

UNION ALL

{% call dbt_unit_testing.test('adjusted_combined', 'STP1, STP2, STP3 are split correctly') %}

  {% call dbt_unit_testing.mock_ref ('adjusted_final') %}
      tvldt    | pos  | poo   | org   | dst   | downal | dmktal | dopral | mktal1 | mktal2 | mktal3 | opral1 | opral2 | opral3 | cnx1  | cnx2  | stp1        | stp2        | stp3        | bkclass_a | bkclass_b | bkclass_c | bkclass_d | bkclass_e | bkclass_f | bkclass_g | bkclass_h | bkclass_i | bkclass_j | bkclass_k | bkclass_l | bkclass_m | bkclass_n | bkclass_o | bkclass_p | bkclass_q | bkclass_r | bkclass_s | bkclass_t | bkclass_u | bkclass_v | bkclass_w | bkclass_x | bkclass_y | bkclass_z | bkgunkwncls | total | cnx1a    | cnx2a    | file_date    | file_type        | load_timestamp
      '202001' | 'TR' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLLMMM'    | 'OOOPPP'    | 'RRRSSS'    | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | 'ZZZ'    | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      '202001' | 'AA' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLL'       | 'OOO'       | 'RRR'       | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | 'ZZZ'    | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      '202001' | 'AA' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | null        | null        | null        | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | 'ZZZ'    | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
  {% endcall %}

  {% call dbt_unit_testing.expect() %}
      traffic_id                                                                                                                        | travel_month | point_of_sale_country | point_of_origin_airport | scheduled_departure_airport_iata | scheduled_arrival_airport_iata | dominant_owner_carrier | dominant_marketing_carrier | dominant_operating_carrier | marketing_carrier_leg_1 | marketing_carrier_leg_2 | marketing_carrier_leg_3 | operating_carrier_leg_1 | operating_carrier_leg_2 | operating_carrier_leg_3 | connecting_airport_1 | connecting_airport_2 | connecting_airport_1_a | connecting_airport_2_a | stopping_airport_1_leg_1 | stopping_airport_2_leg_1 | stopping_airport_3_leg_1 | stopping_airport_1_leg_2 | stopping_airport_2_leg_2 | stopping_airport_3_leg_2 | stopping_airport_1_leg_3 | stopping_airport_2_leg_3 | stopping_airport_3_leg_3 | passengers_booking_class_a | passengers_booking_class_b | passengers_booking_class_c | passengers_booking_class_d | passengers_booking_class_e | passengers_booking_class_f | passengers_booking_class_g | passengers_booking_class_h | passengers_booking_class_i | passengers_booking_class_j | passengers_booking_class_k | passengers_booking_class_l | passengers_booking_class_m | passengers_booking_class_n | passengers_booking_class_o | passengers_booking_class_p | passengers_booking_class_q | passengers_booking_class_r | passengers_booking_class_s | passengers_booking_class_t | passengers_booking_class_u | passengers_booking_class_v | passengers_booking_class_w | passengers_booking_class_x | passengers_booking_class_y | passengers_booking_class_z | passengers_booking_class_unknown | passengers_total | file_date    | file_type        | LOAD_TIMESTAMP
      'ADJUSTED FINAL/2020-01-01/TR/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/null/OOO/PPP/null/RRR/SSS/null/YYY/ZZZ'      | '2020-01-01' | 'TR'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | null                     | 'OOO'                    | 'PPP'                    | null                    | 'RRR'                     | 'SSS'                    |  null                    | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      'ADJUSTED FINAL/2020-01-01/AA/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/null/null/OOO/null/null/RRR/null/null/YYY/ZZZ'   | '2020-01-01' | 'AA'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | null                     | null                     | 'OOO'                    | null                     | null                    | 'RRR'                     | null                     |  null                    | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      'ADJUSTED FINAL/2020-01-01/AA/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/null/null/null/null/null/null/null/null/null/YYY/ZZZ'| '2020-01-01' | 'AA'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | null                     | null                     | null                     | null                     | null                     | null                    | null                      | null                     |  null                    | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
  {% endcall %}

{% endcall %}

UNION ALL

{% call dbt_unit_testing.test('adjusted_combined', 'legs_total is calculated correctly') %}

  {% call dbt_unit_testing.mock_ref ('adjusted_final') %}
      tvldt    | pos  | poo   | org   | dst   | downal | dmktal | dopral | mktal1 | mktal2 | mktal3 | opral1 | opral2 | opral3 | cnx1  | cnx2  | stp1        | stp2        | stp3        | bkclass_a | bkclass_b | bkclass_c | bkclass_d | bkclass_e | bkclass_f | bkclass_g | bkclass_h | bkclass_i | bkclass_j | bkclass_k | bkclass_l | bkclass_m | bkclass_n | bkclass_o | bkclass_p | bkclass_q | bkclass_r | bkclass_s | bkclass_t | bkclass_u | bkclass_v | bkclass_w | bkclass_x | bkclass_y | bkclass_z | bkgunkwncls | total | cnx1a    | cnx2a    | file_date    | file_type        | load_timestamp
      '202001' | 'TR' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | null   | null   | 'GG'   | null   | null   | null  | null  | 'LLLMMMNNN' | null        | null        | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | null     | null     | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      '202002' | 'AA' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | null   | 'GG'   | 'HH'   | null   | 'JJJ' | null  | 'LLLMMMNNN' | 'OOOPPPQQQ' | null        | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | null     | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      '202003' | 'BA' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | 'ZZZ'    | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      '202004' | 'WA' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | null     | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      '202005' | 'WA' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | 'KKK' | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | null     | 'ZZZ'    | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      '202006' | 'WA' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | 'JJJ' | null  | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | 'ZZZ'    | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      '202007' | 'WA' | 'EZS' | 'AYT' | 'EZS' | 'AA'   | 'BB'   | 'CC'   | 'DD'   | 'EE'   | 'FF'   | 'GG'   | 'HH'   | 'II'   | null  | 'KKK' | 'LLLMMMNNN' | 'OOOPPPQQQ' | 'RRRSSSTTT' | 1         | 2         | 3         | 4         | 5         | 6         | 7         | 8         | 9         | 10        | 11        | 12        | 13        | 14        | 15        | 16        | 17        | 18        | 19        | 20        | 21        | 22        | 23        | 24        | 25        | 26        | 27          | 28    | 'YYY'    | 'ZZZ'    | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
  {% endcall %}

  {% call dbt_unit_testing.expect() %}
      traffic_id                                                                                                                                  | travel_month     | point_of_sale_country | point_of_origin_airport | scheduled_departure_airport_iata | scheduled_arrival_airport_iata | dominant_owner_carrier | dominant_marketing_carrier | dominant_operating_carrier | marketing_carrier_leg_1 | marketing_carrier_leg_2 | marketing_carrier_leg_3 | operating_carrier_leg_1 | operating_carrier_leg_2 | operating_carrier_leg_3 | connecting_airport_1 | connecting_airport_2 | connecting_airport_1_a | connecting_airport_2_a | stopping_airport_1_leg_1 | stopping_airport_2_leg_1 | stopping_airport_3_leg_1 | stopping_airport_1_leg_2 | stopping_airport_2_leg_2 | stopping_airport_3_leg_2 | stopping_airport_1_leg_3 | stopping_airport_2_leg_3 | stopping_airport_3_leg_3 | legs_total | passengers_booking_class_a | passengers_booking_class_b | passengers_booking_class_c | passengers_booking_class_d | passengers_booking_class_e | passengers_booking_class_f | passengers_booking_class_g | passengers_booking_class_h | passengers_booking_class_i | passengers_booking_class_j | passengers_booking_class_k | passengers_booking_class_l | passengers_booking_class_m | passengers_booking_class_n | passengers_booking_class_o | passengers_booking_class_p | passengers_booking_class_q | passengers_booking_class_r | passengers_booking_class_s | passengers_booking_class_t | passengers_booking_class_u | passengers_booking_class_v | passengers_booking_class_w | passengers_booking_class_x | passengers_booking_class_y | passengers_booking_class_z | passengers_booking_class_unknown | passengers_total | file_date    | file_type        | load_timestamp
      'ADJUSTED FINAL/2020-01-01/TR/EZS/AYT/EZS/AA/BB/CC/DD/null/null/GG/null/null/null/null/LLL/MMM/NNN/null/null/null/null/null/null/null/null' | '2020-01-01'     | 'TR'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | null                    | null                    | 'GG'                    | null                    | null                    | null                 | null                 | null                   | null                   | 'LLL'                    | 'MMM'                    | 'NNN'                    | null                     | null                     | null                     | null                     | null                     | null                     | 1          | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      'ADJUSTED FINAL/2020-02-01/AA/EZS/AYT/EZS/AA/BB/CC/DD/EE/null/GG/HH/null/JJJ/null/LLL/MMM/NNN/OOO/PPP/QQQ/null/null/null/YYY/null'          | '2020-02-01'     | 'AA'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | null                    | 'GG'                    | 'HH'                    | null                    | 'JJJ'                | null                 | 'YYY'                  | null                   | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | null                     | null                     |  null                    | 2          | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      'ADJUSTED FINAL/2020-03-01/BA/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ'                   | '2020-03-01'     | 'BA'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | 3          | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      'ADJUSTED FINAL/2020-04-01/WA/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/null'                  | '2020-04-01'     | 'WA'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | 'YYY'                  | null                   | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | null       | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      'ADJUSTED FINAL/2020-05-01/WA/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/null/ZZZ'                  | '2020-05-01'     | 'WA'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | 'KKK'                | null                   | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | null       | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      'ADJUSTED FINAL/2020-06-01/WA/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/JJJ/null/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ'                  | '2020-06-01'     | 'WA'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | 'JJJ'                | null                 | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | null       | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
      'ADJUSTED FINAL/2020-07-01/WA/EZS/AYT/EZS/AA/BB/CC/DD/EE/FF/GG/HH/II/null/KKK/LLL/MMM/NNN/OOO/PPP/QQQ/RRR/SSS/TTT/YYY/ZZZ'                  | '2020-07-01'     | 'WA'                  | 'EZS'                   | 'AYT'                            | 'EZS'                          | 'AA'                   | 'BB'                       | 'CC'                       | 'DD'                    | 'EE'                    | 'FF'                    | 'GG'                    | 'HH'                    | 'II'                    | null                 | 'KKK'                | 'YYY'                  | 'ZZZ'                  | 'LLL'                    | 'MMM'                    | 'NNN'                    | 'OOO'                    | 'PPP'                    | 'QQQ'                    | 'RRR'                    | 'SSS'                    |  'TTT'                   | null       | 1                          | 2                          | 3                          | 4                          | 5                          | 6                          | 7                          | 8                          | 9                          | 10                         | 11                         | 12                         | 13                         | 14                         | 15                         | 16                         | 17                         | 18                         | 19                         | 20                         | 21                         | 22                         | 23                         | 24                         | 25                         | 26                         | 27                               | 28               | '2020-01-01' | 'ADJUSTED FINAL' | '2017-01-01 12:00:00'
  {% endcall %}
{% endcall %}